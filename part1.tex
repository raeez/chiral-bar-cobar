\chapter{Operadic Foundations and Bar Constructions}

\section{Classical Koszul Duality: The Algebraic Foundation}
\label{sec:classical-koszul-foundation}

Before developing chiral Koszul duality, we must establish the classical algebraic theory that it enhances. This section provides the complete foundation.

\subsection{Quadratic Algebras and Koszul Duality}

\begin{definition}[Quadratic Algebra]
\label{def:quadratic-algebra}
A graded algebra $A = T(V)/I$ is \textbf{quadratic} if:
\begin{enumerate}
\item $V$ is a graded vector space (generators)
\item $I \subset V \otimes V$ is a subspace of relations in degree 2
\item The defining ideal is $(I)$ generated by $I$
\end{enumerate}
We write $A = A(V, R)$ where $R \subset V \otimes V$ are the relations.
\end{definition}

\begin{example}[Prototypical Examples]
\label{ex:classical-quadratic-algebras}
\begin{enumerate}
\item \textbf{Commutative algebra} $\text{Sym}(V)$:
\begin{align}
\text{Generators:} &\quad V \\
\text{Relations:} &\quad R_{\text{Com}} = \{v \otimes w - w \otimes v : v,w \in V\} \subset V \otimes V
\end{align}

\item \textbf{Exterior algebra} $\Lambda(V)$:
\begin{align}
\text{Generators:} &\quad V \\
\text{Relations:} &\quad R_{\text{Lie}} = \{v \otimes w + w \otimes v : v,w \in V\} \subset V \otimes V
\end{align}

\item \textbf{Universal enveloping} $U(\mathfrak{g})$ for Lie algebra $\mathfrak{g}$:
\begin{align}
\text{Generators:} &\quad \mathfrak{g} \\
\text{Relations:} &\quad R_{\mathfrak{g}} = \{x \otimes y - y \otimes x - [x,y] : x,y \in \mathfrak{g}\}
\end{align}
\end{enumerate}
\end{example}

\subsection{The Koszul Dual Coalgebra}

\begin{construction}[Quadratic Dual]
\label{const:quadratic-dual}
Given a quadratic algebra $A = A(V,R)$, define its \textbf{quadratic dual} $A^! = A(V^*, R^\perp)$ by:
\begin{align}
\text{Generators:} &\quad V^* \quad \text{(dual space)} \\
\text{Relations:} &\quad R^\perp = \{r \in V^* \otimes V^* : \langle r, s \rangle = 0 \text{ for all } s \in R\}
\end{align}
where the pairing is:
\begin{equation}
\langle \alpha \otimes \beta, v \otimes w \rangle = \langle \alpha, v \rangle \langle \beta, w \rangle
\end{equation}
\end{construction}

\begin{remark}[Orthogonality Principle]
The key observation: $R$ and $R^\perp$ are \textbf{orthogonal complements} in $V \otimes V$ and $V^* \otimes V^*$ respectively. This orthogonality is the concrete manifestation of duality.
\end{remark}

\subsection{Koszul Pairs: Precise Definition}

\begin{definition}[Koszul Pair]
\label{def:koszul-pair-classical}
A pair of quadratic algebras $(A_1, A_2)$ is a \textbf{Koszul pair} if:
\begin{enumerate}
\item $\bar{B}(A_1) \simeq A_2^!$ (as coalgebras)
\item $\bar{B}(A_2) \simeq A_1^!$ (as coalgebras)
\item $\Omega(\bar{B}(A_1)) \simeq A_1$ (cobar inverts bar)
\item $\Omega(\bar{B}(A_2)) \simeq A_2$ (cobar inverts bar)
\end{enumerate}
\end{definition}

\begin{remark}[Two Phenomena Distinguished]
\label{rem:two-phenomena}
Conditions (1-2) establish \textbf{Koszul duality}: $A_1$ and $A_2$ encode dual coalgebraic information.

Conditions (3-4) establish \textbf{bar-cobar inversion}: the composite $\Omega \circ \bar{B}$ is homotopy equivalent to the identity.

These are \textbf{distinct} mathematical phenomena! The key insight:
\begin{itemize}
\item $\bar{B}(A_1) \simeq A_2^!$ means: the bar of $A_1$ produces the \emph{dual coalgebra to $A_2$}
\item $\Omega(\bar{B}(A_1)) \simeq A_1$ means: cobar reconstructs $A_1$ from its bar coalgebra
\item Together: $A_1$ and $A_2$ are Koszul dual, with bar-cobar mediating the duality
\end{itemize}
\end{remark}

\subsection{Classical Examples Revisited}

\begin{theorem}[Classical Koszul Pairs]
The following are Koszul pairs in the sense of Definition \ref{def:koszul-pair-classical}:
\begin{enumerate}
\item $(\text{Sym}(V), \Lambda(V^*))$ — commutative and exterior algebras
\item $(U(\mathfrak{g}), C^*_{\text{CE}}(\mathfrak{g}))$ — universal enveloping and Chevalley-Eilenberg cochains
\item $(T(V), T^c(V^*))$ — tensor algebra and tensor coalgebra
\end{enumerate}
Each pair satisfies all four conditions of Definition \ref{def:koszul-pair-classical}.
\end{theorem}

We now build the chiral enhancement of this classical structure.

\section{The Essence of Koszul Duality: From Classical to Chiral}
\label{sec:essence-koszul-duality}

\subsection{The Fundamental Question}

Before diving into technical definitions, we must understand the \emph{conceptual core} 
of Koszul duality. This understanding will guide us from classical quadratic algebras 
to general chiral algebras.

\begin{principle}[The Central Insight]
\label{princ:koszul-central-insight}
Koszul duality is \textbf{not} primarily about:
\begin{itemize}
\item Quadratic relations (those are just the simplest case)
\item Generator-relation presentations (useful but not essential)
\item Specific algebraic structures (associative, Lie, operadic)
\end{itemize}

Koszul duality \textbf{is} fundamentally about:
\begin{center}
\fbox{\parbox{0.85\textwidth}{
\textit{Two algebraic structures related through bar-cobar where $\bar(A_1) \simeq A_2^!$ 
(the dual coalgebra of $A_2$). The key: $\bar{B}(A_1)$ encodes information about $A_2$, 
but $\cobar(\Bar{B}(A_1))$ still reconstructs $A_1$ via the universal bar-cobar adjunction. 
The Koszul duality manifests through $Ω(A₂^1) ≃ A₁$.}
}}
\end{center}
\end{principle}

\begin{remark}[Elementary Observation]
Think of it this way:
\begin{itemize}
\item An algebra $\mathcal{A}_1$ has \textbf{products} (how to multiply things)
\item The bar construction $\bar{B}(\mathcal{A}_1)$ produces a coalgebra with 
      \textbf{coproducts} (how to split things apart)
\item If $(\mathcal{A}_1, \mathcal{A}_2)$ are Koszul dual, then:
      $$\bar{B}(\mathcal{A}_1) \simeq \mathcal{A}_2^!$$
      means: ``the way to split apart $\mathcal{A}_1$ is exactly the dual of 
      the way to multiply $\mathcal{A}_2$''
\item The cobar construction $\Omega(\mathcal{A}_2^!)$ then rebuilds $\mathcal{A}_1$ 
      by interpreting those splitting rules as multiplication rules for the partner
\end{itemize}

This is a \textbf{perfect duality}: neither algebra is more fundamental—each contains 
complete information about its partner encoded coalgebraically.
\end{remark}

\subsection{Two Phenomena That Must Be Distinguished}
\label{subsec:two-phenomena-distinguished}

A source of confusion in the literature stems from conflating two separate mathematical 
phenomena. We clarify this distinction before proceeding.

\begin{definition}[Bar-Cobar Inversion]
\label{def:bar-cobar-inversion}
For \textbf{any} algebra $\mathcal{A}$ (in any reasonable algebraic category), the 
bar and cobar constructions satisfy:
$$\Omega(\bar{B}(\mathcal{A})) \xrightarrow{\sim} \mathcal{A}$$
as a quasi-isomorphism of algebras.

\textbf{Status}: This is a \textsc{tautology}. It holds by the definition of the 
bar-cobar adjunction. The cobar functor is constructed precisely to be left adjoint 
to the bar functor.

\textbf{Interpretation}: ``If you encode an algebra as a coalgebra (bar), then decode 
that coalgebra back to an algebra (cobar), you return to where you started.''
\end{definition}

\begin{definition}[Koszul Duality]
\label{def:koszul-duality-phenomenon}
For a special pair of algebras $(\mathcal{A}_1, \mathcal{A}_2)$, we have the much 
stronger property:
\begin{align}
\bar{B}(\mathcal{A}_1) &\simeq \mathcal{A}_2^! \quad \text{(as coalgebras)} \\
\bar{B}(\mathcal{A}_2) &\simeq \mathcal{A}_1^! \quad \text{(as coalgebras)} \\
\Omega(\mathcal{A}_1^!) &\simeq \mathcal{A}_2 \quad \text{(as algebras)} \\
\Omega(\mathcal{A}_2^!) &\simeq \mathcal{A}_1 \quad \text{(as algebras)}
\end{align}

\textbf{Status}: This is a \textsc{non-trivial theorem}. It must be verified case-by-case 
and holds only for special pairs.

\textbf{Interpretation}: ``The bar construction of $\mathcal{A}_1$ doesn't just encode 
$\mathcal{A}_1$—it encodes a \emph{different} algebra $\mathcal{A}_2$! Applying cobar 
to $\bar{B}(\mathcal{A}_1)$ gives back $\mathcal{A}_1$.''
\end{definition}

\begin{remark}[The Diagnostic Test]
\label{rem:diagnostic-koszul-test}
To determine whether $(\mathcal{A}_1, \mathcal{A}_2)$ form a Koszul pair, compute:
$$\Omega(\bar{B}(\mathcal{A}_1)) \stackrel{?}{\simeq} \mathcal{A}_2$$

\textbf{Three possibilities}:
\begin{enumerate}
\item $\Omega(\bar{B}(\mathcal{A}_1)) \simeq \mathcal{A}_1$ always (bar-cobar inversion)
\item $\Omega(\bar{B}(\mathcal{A}_1)) \simeq \mathcal{A}_2 \neq \mathcal{A}_1$ 
      (Koszul duality—the interesting case!)

\end{enumerate}
\end{remark}

\begin{example}[Three Concrete Instances]
\label{ex:three-koszul-instances}

\textbf{Example 1: Free Fermions}

Let $\mathcal{F}$ be the free fermion chiral algebra with generator $\psi(z)$ and OPE:
$$\psi(z)\psi(w) \sim \frac{1}{z-w}$$

Computation shows:
$$\Omega(\bar{B}(\mathcal{F})) \simeq \mathcal{F}$$


\textbf{Example 2: Heisenberg Algebra (Non-Self-Dual—Corrected)}

Let $\mathcal{H}_k$ be the Heisenberg chiral algebra with generator $\alpha(z)$ and OPE:
$$\alpha(z)\alpha(w) \sim \frac{k}{(z-w)^2}$$
 
$$\bar{B}(\mathcal{H}_k) \simeq \text{Sym}(V)^! \quad \text{and} \quad 
  \Omega(\bar{B}(\mathcal{H}_k)) \simeq \mathcal{H}_k)$$

where $\text{Sym}(V)$ is the \textbf{commutative} chiral algebra.

\textbf{Conclusion}: $(\mathcal{H}_k, \text{Sym}(V))$ form a Koszul pair. The level $k$ 
parameterizes the central extension but doesn't change the identity of the Koszul dual.

\textbf{Why the confusion?} There are \emph{three different dualities} for Heisenberg:
\begin{enumerate}
\item \textbf{Bar-cobar Koszul duality}: $\mathcal{H}_k^! \simeq \text{Sym}(V)$ 
      (this is what we study)
\item \textbf{Level-shifting}: $k \leftrightarrow -k$ in representation categories 
      (representation theory)
\item \textbf{Boson-fermion correspondence}: $\mathcal{H}_k \simeq \mathcal{F}^{\otimes 2}$ 
      (categorical equivalence)
\end{enumerate}
These are \textbf{different structures}—only (1) is bar-cobar Koszul duality.

\textbf{Example 3: βγ System and Free Fermions (Non-Trivial Pair)}

Let $\mathcal{BG}$ be the $\beta\gamma$ symplectic boson system with fields $\beta(z), \gamma(z)$ 
and OPE:
$$\beta(z)\gamma(w) \sim \frac{1}{z-w}$$

Computation shows:
$$\bar{B}(\mathcal{BG}) \simeq \mathcal{F}^!$$
where $\mathcal{F}$ is the free fermion algebra.

\textbf{Conclusion}: $(\mathcal{BG}, \mathcal{F})$ form a Koszul pair. The bosonic $\beta\gamma$ 
system and fermionic $\psi$ system are Koszul dual—this is the boson-fermion correspondence 
at the level of chiral algebras.
\end{example}

\subsection{Precise Definition of Chiral Koszul Pairs}
\label{subsec:chiral-koszul-pairs-precise}

We now give the definitive definition that applies to all chiral algebras, not just 
quadratic ones.

\begin{definition}[Chiral Koszul Pair—Version I: Bar-Cobar Characterization]
\label{def:chiral-koszul-pair-bar-cobar}
Two chiral algebras $(\mathcal{A}_1, \mathcal{A}_2)$ on a smooth curve $X$ form a 
\textbf{chiral Koszul pair} if they satisfy:

\begin{enumerate}
\item \textbf{Bar produces dual coalgebra}:
      $$\bar{B}^{\text{ch}}(\mathcal{A}_1) \simeq \mathcal{A}_2^!$$
      as a quasi-isomorphism of chiral coalgebras, where $\mathcal{A}_2^!$ is the 
      Koszul dual coalgebra to $\mathcal{A}_2$

\item \textbf{Symmetry}:
      $$\bar{B}^{\text{ch}}(\mathcal{A}_2) \simeq \mathcal{A}_1^!$$
      as a quasi-isomorphism of chiral coalgebras

\item \textbf{Cobar reconstructs partner}:
      $$\Omega^{\text{ch}}(\mathcal{A}_2^!) \simeq \mathcal{A}_2 \quad \text{and} \quad 
        \Omega^{\text{ch}}(\mathcal{A}_1^!) \simeq \mathcal{A}_1$$
      as quasi-isomorphisms of chiral algebras
\end{enumerate}
\end{definition}

\begin{remark}[Why This Definition Works]
\label{rem:why-definition-works}
This definition:
\begin{itemize}
\item \textbf{Escapes quadratic constraint}: Makes no reference to presentations by 
      generators and relations
\item \textbf{Captures essential duality}: The bar of one is the coalgebra dual to the other
\item \textbf{Is geometrically computable}: Configuration spaces provide explicit realizations
\item \textbf{Includes classical cases}: Quadratic Koszul pairs satisfy these conditions
\item \textbf{Extends to physics}: Natural for vertex operator algebras and CFT
\end{itemize}
\end{remark}

\begin{definition}[Chiral Koszul Pair—Version II: Twisting Morphism Characterization]
\label{def:chiral-koszul-pair-twisting}
Equivalently, $(\mathcal{A}_1, \mathcal{A}_2)$ form a chiral Koszul pair if there exists 
a \textbf{universal twisting morphism} $\tau_{12}: \mathcal{A}_1^! \to \mathcal{A}_2$ 
satisfying the Maurer-Cartan equation:
$$d\tau_{12} + \frac{1}{2}[\tau_{12}, \tau_{12}] = 0$$

which induces quasi-isomorphisms:
\begin{align}
\mathcal{A}_1 &\simeq \Omega^{\text{ch}}(\mathcal{A}_2^!)_{\tau_{12}} \\
\mathcal{A}_2 &\simeq (\mathcal{A}_1)_{\tau_{12}}
\end{align}
where subscript $\tau$ denotes twisting by $\tau$.
\end{definition}

\begin{remark}[The Twisting Morphism Perspective]
\label{rem:twisting-perspective}
The twisting morphism $\tau_{12}$ is the \textbf{explicit map} realizing the Koszul duality:
\begin{itemize}
\item \textbf{Domain and codomain}: $\tau_{12}: \mathcal{A}_1^! \to \mathcal{A}_2$ goes 
      from the coalgebra dual to algebra
\item \textbf{Maurer-Cartan equation}: Ensures $\tau$ intertwines structures correctly
\item \textbf{Geometric realization}: 
      $$\tau(c \otimes d) = \int_{\overline{C}_2(X)} \text{ev}^*(c \otimes d) \wedge K(z_1, z_2)$$
      where $K$ is a universal integration kernel
\item \textbf{Universality}: Any other twisting factors through $\tau_{12}$
\end{itemize}

This perspective connects to Gui-Li-Zeng's framework where Koszul duality is expressed 
through Maurer-Cartan elements in $\mathcal{A}_1^! \otimes \mathcal{A}_2$.
\end{remark}

\subsection{The Gui-Li-Zeng Quadratic Duality Framework}
\label{subsec:gui-li-zeng-framework}

Our geometric approach to chiral Koszul duality is deeply connected to the algebraic 
framework developed by Gui, Li, and Zeng in their paper ``Quadratic duality for chiral 
algebras'' \cite{GLZ22} (arXiv:2212.11252).

\begin{framework}[Gui-Li-Zeng Setup]
\label{framework:glz}
Gui-Li-Zeng define Koszul duality for chiral algebras through:

\textbf{1. Chiral Quadratic Data}

A pair $(N, P)$ where:
\begin{itemize}
\item $N$ is a sheaf of generators (chiral vector space)
\item $P \subset j_* j^* (N \boxtimes N)$ is a subsheaf of quadratic relations
\end{itemize}

The quadratic chiral algebra is:
$$\mathcal{A}(N, P) = \frac{\mathcal{A}(N)}{(P)}$$
where $\mathcal{A}(N)$ is the free chiral algebra on $N$.

\textbf{2. Dualizable Quadratic Data}

$(N, P)$ is \emph{dualizable} if $(s^{-1}N^{\vee}\omega^{-1}, P^{\perp})$ is also a chiral 
quadratic datum, where:
\begin{itemize}
\item $N^{\vee}\omega^{-1}$ is the dual with twist by inverse canonical bundle
\item $P^{\perp}$ is the chiral annihilator defined by:
      $$\mu(\langle P \otimes \omega_{X^2}, P^{\perp} \otimes s^2\omega_{X^2}\rangle) = 0$$
      under the unit chiral operation $\mu$
\end{itemize}

\textbf{3. The Quadratic Dual}

For dualizable $(N, P)$, the quadratic dual is:
$$\mathcal{A}^! = \mathcal{A}(s^{-1}N^{\vee}\omega^{-1}, P^{\perp})$$

\textbf{4. Maurer-Cartan Correspondence}

The key theorem: there is a bijection
$$\text{Hom}(\mathcal{A}, \mathcal{B}) \leftrightarrow MC(\mathcal{A}^! \otimes \mathcal{B})$$
between morphisms of chiral algebras and Maurer-Cartan elements in the tensor product.
\end{framework}

\begin{theorem}[Comparison: Our Approach vs GLZ]
\label{thm:comparison-our-glz}
Our geometric bar-cobar framework and the GLZ algebraic framework are related as follows:

\begin{enumerate}
\item \textbf{Quadratic Case Agreement}:
   
   For quadratic chiral algebras, our bar construction:
   $$\bar{B}^{\text{ch}}(\mathcal{A}(N,P)) \simeq \mathcal{A}(s^{-1}N^{\vee}\omega^{-1}, P^{\perp})^!$$
   reproduces the GLZ dual coalgebra.

\item \textbf{Non-Quadratic Extension}:
   
   Our framework extends to non-quadratic algebras by replacing:
   \begin{itemize}
   \item Quadratic relations $P$ → OPE structure of arbitrary pole order
   \item Annihilator $P^{\perp}$ → Residue extraction at collision divisors
   \item Algebraic dualization → Geometric Poincaré-Verdier duality
   \end{itemize}

\item \textbf{Maurer-Cartan Elements}:
   
   The GLZ Maurer-Cartan element $\alpha \in MC(\mathcal{A}^! \otimes \mathcal{B})$ corresponds 
   to our twisting morphism:
   $$\tau: \mathcal{A}^! \to \mathcal{B}$$
   realized geometrically as an integration kernel on $\overline{C}_2(X)$:
   $$\tau(c)(z) = \int_{\overline{C}_2(X)} \text{ev}^* c(w) \wedge K(z, w)$$

\item \textbf{Curved Structures}:
   
   GLZ's framework naturally handles curved $A_{\infty}$ algebras through Maurer-Cartan 
   deformations. Our configuration space approach realizes these deformations as:
   \begin{itemize}
   \item Curvature = Higher genus corrections
   \item Maurer-Cartan equation = Stokes' theorem on $\overline{C}_n(X)$
   \item Solutions = Consistent genus-by-genus quantum corrections
   \end{itemize}
\end{enumerate}
\end{theorem}

\begin{remark}[Advantages of Each Approach]
\label{rem:advantages-comparison}

\textbf{GLZ Algebraic Approach}:
\begin{itemize}
\item[+] Clean algebraic formulation
\item[+] Direct definition of dual via annihilators
\item[+] Natural connection to deformation theory
\item[+] Explicit in quadratic case
\item[−] Limited to quadratic or near-quadratic examples
\item[−] Abstract, not immediately computable for complicated algebras
\end{itemize}

\textbf{Our Geometric Approach}:
\begin{itemize}
\item[+] Applies to arbitrary pole order (non-quadratic)
\item[+] Explicitly computable via configuration spaces
\item[+] Natural genus expansion and quantum corrections
\item[+] Physical interpretation via Feynman diagrams
\item[+] Connects to Poincaré-Verdier duality
\item[−] Technically more involved (compactifications, stratifications, Arnold relations)
\item[−] Requires careful analysis of convergence and regularization
\end{itemize}

\textbf{Together}: The two approaches are complementary. GLZ provides conceptual clarity 
and algebraic foundations. Our geometric framework provides computational power and extends 
to non-quadratic examples essential for physics (Virasoro, W-algebras, Yangian).
\end{remark}
 
\section{Symmetric Sequences and Operads}

\begin{definition}[Symmetric Monoidal Category]
We work in the symmetric monoidal $\infty$-category $\mathcal{V} = \text{Ch}_\mathbb{C}$ of 
cochain complexes over $\mathbb{C}$ with cohomological grading. The monoidal structure is given by:
\begin{itemize}
\item Unit object: $\mathbb{C}$ concentrated in degree 0
\item Tensor product: $(V \otimes W)^n = \bigoplus_{i+j=n} V^i \otimes W^j$
\item Differential: $d(v \otimes w) = dv \otimes w + (-1)^{|v|}v \otimes dw$
\item Symmetry: $\tau(v \otimes w) = (-1)^{|v||w|}w \otimes v$
\end{itemize}
\textbf{Convention:} We use cohomological grading throughout: $\deg(d) = +1$.

All constructions respect this grading and differential structure. For a morphism $f: V \to W$ of degree $|f|$, the Koszul sign rule gives $f(v \otimes w) = (-1)^{|f||v|}f(v) \otimes w$ when extended to tensor products.

% Added for clarity
\textbf{Explicit Grading Convention:} Throughout this paper, we use cohomological grading with $\deg(d) = +1$, and all degree shifts should be interpreted in this context. For a complex $(C^\bullet, d)$, we have $d: C^n \to C^{n+1}$.

\textbf{Sign Convention for Composition:} When composing morphisms of degree $p$ and $q$, we use the Koszul sign rule: passing an element of degree $p$ past an element of degree $q$ introduces the sign $(-1)^{pq}$.

\textbf{Differential Graded Context:} All categories considered are enriched over the category of cochain complexes, with morphism spaces carrying natural differential structures compatible with composition.

\end{definition}

Let $\cV$ be a symmetric monoidal $\infty$-category. In practice, we primarily work with the category of chain complexes over $\C$ (the field of complex numbers), but the constructions apply more generally to any stable presentable symmetric monoidal category. The choice of characteristic 0 is essential for our residue calculus and will be assumed throughout unless otherwise stated.
 
\begin{definition}[Symmetric Sequence]
A \emph{symmetric sequence} is a collection $P = \{P(n)\}_{n \geq 0}$ where each $P(n)$ is an object of $\cV$ equipped with a right action of the symmetric group $S_n$. Morphisms of symmetric sequences are collections of $S_n$-equivariant maps. When $\cV$ carries a differential structure, we require that the $S_n$-action commutes with differentials.
\end{definition}
 
The fundamental operation on symmetric sequences is the composition product, which encodes the substitution of operations:
 
\begin{definition}[Composition Product]
For symmetric sequences $A$ and $B$, their composition product is defined by:
\[
(A \circ B)(n) = \bigoplus_{k \geq 0} A(k) \otimes_{S_k} \left( \bigoplus_{i_1 + \cdots + i_k = n} \Ind_{S_{i_1} \times \cdots \times S_{i_k}}^{S_n}(B(i_1) \otimes \cdots \otimes B(i_k)) \right)
\]
where $\Ind$ denotes the induced representation functor, using the block diagonal embedding 
\[
S_{i_1} \times \cdots \times S_{i_k} \hookrightarrow S_n
\]
that acts on $\{1, \ldots, i_1\} \sqcup \{i_1 + 1, \ldots, i_1 + i_2\} \sqcup \cdots \sqcup \{i_1 + \cdots + i_{k-1} + 1, \ldots, n\}$.
\end{definition}
 
The composition product is associative up to canonical isomorphism, with unit given by the symmetric sequence $\mathbb{I}$ with $\mathbb{I}(1) = \C$ and $\mathbb{I}(n) = 0$ for $n \neq 1$.
 
\section{Chiral Algebras and Non-Abelian Poincaré Duality}
\label{sec:chiral-NAP}

\subsection{Factorization as Local-to-Global}

\begin{principle}[Factorization Encodes Locality]\label{princ:factorization-locality}
The factorization axiom for chiral algebras:
$$\mathcal{A}(U \sqcup V) \simeq \mathcal{A}(U) \otimes \mathcal{A}(V)$$
is the algebraic encoding of locality in quantum field theory.

From the NAP perspective, this is the \textbf{excision property}:
$$\int_{M_1 \sqcup M_2} A = \int_{M_1} A \otimes \int_{M_2} A$$

Factorization algebras are precisely the coefficient systems for non-abelian Poincaré duality.
\end{principle}

\subsection{Ran Space and Universal Recipients}

\begin{definition}[Ran Space]\label{def:ran-space}
The Ran space of X is:
$$\text{Ran}(X) = \varinjlim_{n} X^{(n)} = \coprod_{n \geq 0} X^{(n)}$$
the space of finite non-empty subsets of X.

A factorization algebra on X is equivalent to a constructible sheaf on $\text{Ran}(X)$ satisfying compatibility conditions.
\end{definition}

\begin{theorem}[Chiral Algebras on Ran Space]\label{thm:chiral-ran}
\textup{(Beilinson-Drinfeld, Chapter 3)}

A chiral algebra $\mathcal{A}$ on a curve X determines a D-module $\mathcal{F}_{\mathcal{A}}$ on $\text{Ran}(X)$ satisfying:
\begin{enumerate}
\item Factorization: $\mathcal{F}_{\mathcal{A}}(S \sqcup T) = \mathcal{F}_{\mathcal{A}}(S) \otimes \mathcal{F}_{\mathcal{A}}(T)$
\item Compatibility with embeddings
\item D-module structure encoding OPEs
\end{enumerate}

The bar-cobar duality acts on these sheaves on Ran space, realizing NAP duality for factorization algebras.
\end{theorem}

\subsection{Connection to Our Construction}

Our geometric bar-cobar construction via configuration spaces is the explicit realization of NAP duality for chiral algebras viewed as factorization algebras on Ran space. The configuration space $C_n(X)$ is the n-stratum of Ran(X), and our logarithmic forms encode the factorization structure.

\begin{definition}[Operad]
An \emph{operad} $P$ is a monoid for the composition product, equipped with:
\begin{itemize}
\item Composition maps $\gamma : P(k) \otimes P(i_1) \otimes \cdots \otimes P(i_k) \to P(i_1 + \cdots + i_k)$
\item Unit $\eta : \mathbb{I} \to P(1)$ 
\item Associativity axioms ensuring that multi-level compositions are independent of bracketing
\item Equivariance axioms ensuring compatibility with symmetric group actions
\end{itemize}
When $\cV$ has a differential structure, all structure maps must be chain maps.
\end{definition}
 
\begin{definition}[Cooperad]
A \emph{cooperad} is a comonoid for the composition product, with structure maps dual to those of an operad. Explicitly, we have decomposition maps $\Delta : C(n) \to (C \circ C)(n)$ and a counit $\epsilon : C \to \mathbb{I}$ satisfying coassociativity and coequivariance axioms.
\end{definition}
 
\begin{example}[Endomorphism Operad]
For any object $V \in \cV$, the endomorphism operad $\End_V$ has 
\[
\End_V(n) = \Hom_\cV(V^{\otimes n}, V)
\]
with composition given by substitution of multilinear operations. This is the fundamental example motivating the general theory.
\end{example}
 
\section{The Cotriple Bar Construction}
 
Given an adjunction $F \dashv U : \mathcal{A} \rightleftarrows \mathcal{B}$ (with $F$ left adjoint to $U$), we obtain a comonad (also called a cotriple) $G = FU$ on $\mathcal{B}$ with counit $\epsilon : FU \to \text{id}$ and comultiplication $\delta : FU \to FUFU$ induced by the unit and counit of the adjunction.
 
\begin{definition}[Cotriple Bar Resolution]
The cotriple bar resolution of $B \in \mathcal{B}$ is the simplicial object:
\[
B^G_\bullet(B) : \cdots \rightrightarrows (FU)^3B \rightrightarrows (FU)^2B \rightrightarrows FUB \to B
\]
with face maps $d_i : B^G_n \to B^G_{n-1}$ given by:
\begin{itemize}
\item $d_0 = \epsilon \cdot (FU)^{n-1}$ (apply counit at the first position)
\item $d_i = (FU)^{i-1} \cdot \delta \cdot (FU)^{n-i-1}$ for $0 < i < n$ (apply comultiplication at position $i$)  
\item $d_n = (FU)^{n-1} \cdot \epsilon$ (apply counit at the last position)
\end{itemize}
and degeneracy maps $s_i : B^G_n \to B^G_{n+1}$ given by inserting the unit of the adjunction at position $i$.
\end{definition}
 
\begin{example}[Operadic Bar Construction]
For an operad $P$, the free-forgetful adjunction $F_P \dashv U : P\text{-Alg} \rightleftarrows \cV$ yields the classical bar construction $\barB^P_\bullet(A)$ for any $P$-algebra $A$. Explicitly:
\[
\barB^P_n(A) = P \circ \cdots \circ P \circ A \quad \text{($n$ copies of $P$)}
\]
This agrees with the construction via iterated insertions of operations from $P$. The differential is the alternating sum of face maps.
\end{example}
 
\subsection{The Fundamental Bar-Cobar Isomorphism}

Before proceeding to the chiral setting, we must understand the precise relationship that makes two operads/algebras into a "Koszul pair" in the classical setting. This will serve as the template for our chiral generalization.

\begin{principle}[What Makes a Koszul Pair?]
Two objects form a Koszul pair when their bar and cobar constructions are \emph{not just related by adjunction, but are actual inverses up to quasi-isomorphism}. This means:

\begin{itemize}
\item The bar construction $\barB$ converts algebra structure to coalgebra structure
\item The cobar construction $\Omega$ converts coalgebra structure to algebra structure  
\item For a Koszul pair $(A_1, A_2)$: the coalgebra $\barB(A_1)$ \emph{is} (up to quasi-isomorphism) the "dual" coalgebra that cobar-reconstructs $A_2$
\end{itemize}

This duality manifests concretely through explicit isomorphisms of the underlying structures.
\end{principle}

\begin{definition}[Classical Koszul Pair - Precise Statement]\label{def:classical-koszul-pair}
Two quadratic operads/algebras $(P_1, P_2)$ with presentations:
\begin{align*}
P_1 &= \mathcal{F}(V_1)/(R_1) \\
P_2 &= \mathcal{F}(V_2)/(R_2)
\end{align*}
form a \textbf{Koszul pair} if there exists a perfect pairing $\langle \cdot, \cdot \rangle: V_1 \otimes V_2 \to \mathbb{k}$ such that:

\begin{enumerate}
\item \textbf{Generator duality}: $V_2 \cong V_1^* := \text{Hom}(V_1, \mathbb{k})$ via the pairing

\item \textbf{Relation orthogonality}: $R_1 \perp R_2$ under the induced pairing on relations

\item \textbf{Bar-cobar isomorphism}: There exist quasi-isomorphisms of cooperads and operads:
\begin{align*}
\barB(P_1) &\simeq P_2^! \quad \text{(as cooperads)} \\
\barB(P_2) &\simeq P_1^! \quad \text{(as cooperads)} \\
\Omega(P_1^!) &\simeq P_1 \quad \text{(as operads)} \\
\Omega(P_2^!) &\simeq P_2 \quad \text{(as operads)}
\end{align*}
where $P_i^! = \mathcal{F}^c(V_i^*)/(R_i^\perp)$ is the \emph{Koszul dual cooperad}.
\end{enumerate}
\end{definition}

\begin{remark}[The Key Insight]
The third condition is the \emph{essential content} of being a Koszul pair. It says:
\begin{center}
\textit{The bar construction of $P_1$ literally computes the dual cooperad structure that defines $P_2$}
\end{center}

In other words: if you take $P_1$, apply bar to get a coalgebra, then apply cobar to rebuild an algebra, you recover $P_2$ (up to quasi-isomorphism).
\end{remark}

\begin{example}[Com-Lie: The Prototypical Koszul Pair]
For the commutative and Lie operads:
\begin{itemize}
\item Generators: $\mu \in \text{Com}(2)$ (commutative product) and $\ell \in \text{Lie}(2)$ (Lie bracket)
\item Pairing: $\langle \mu, \ell \rangle = 1$ (canonical pairing between symmetry and antisymmetry)
\item Bar-cobar isomorphisms:
\begin{align*}
\barB(\text{Com}) &\simeq \text{Lie}^! \quad \text{(partition complex computes Lie dual)} \\
\barB(\text{Lie}) &\simeq \text{Com}^! \quad \text{(Chevalley-Eilenberg computes Com dual)} \\
\Omega(\text{Lie}^!) &\simeq \text{Com} \quad \text{(cobar reconstructs commutative structure)} \\
\Omega(\text{Com}^!) &\simeq \text{Lie} \quad \text{(cobar reconstructs Lie structure)}
\end{align*}
\end{itemize}

Concretely: the bar complex of the commutative operad is the chain complex of the partition lattice, whose homology is precisely the Lie operad (with sign).
\end{example}

\begin{remark}[Why This Matters for Chiral Algebras]
In the chiral setting, we will generalize this by:
\begin{itemize}
\item Replacing operads with chiral algebras (factorization algebras on curves)
\item Replacing abstract cooperads with geometric coalgebras (residues on configuration spaces)
\item The isomorphism $\barB(\mathcal{A}_1) \simeq \mathcal{A}_2^!$ becomes a geometric statement about how logarithmic forms (bar side) relate to distributional kernels (cobar side)
\end{itemize}
The fundamental principle remains: \textbf{Koszul pairs are characterized by bar-cobar being mutually inverse operations}.
\end{remark}

\section{The Operadic Bar-Cobar Duality}
 
For an augmented operad $P$ with augmentation $\epsilon : P \to \mathbb{I}$, we construct the bar and cobar functors that establish a fundamental duality:
 
\begin{definition}[Operadic Bar Construction]
The bar construction $\barB(P)$ is the cofree cooperad on the suspension $s\bar{P}$ (where $\bar{P} = \ker(\epsilon)$ is the augmentation ideal) with differential induced by the operadic multiplication. Explicitly:
\[
\barB(P) = T^c(s\bar{P}) = \bigoplus_{n \geq 0} (s\bar{P})^{\circ n}
\]
where $T^c$ denotes the cofree cooperad functor, $(-)^{\circ n}$ denotes the $n$-fold cooperadic composition,
and the differential $d: \barB(P) \to \barB(P)$ is given by:
\[
d = d_{\text{internal}} + d_{\text{decomposition}}
\]
where:
\begin{itemize}
\item $d_{\text{internal}}$ uses the internal differential of $P$
\item $d_{\text{decomposition}}$ encodes edge contractions on trees decorated with operations from $P$
\end{itemize}
\end{definition}

\section{From Cotriple to Geometry: The Conceptual Bridge}

\begin{remark}[Why Configuration Spaces? - The Deep Answer]
The appearance of configuration spaces in the bar complex is not coincidental but forced by the 
fundamental theorem of factorization homology (Ayala-Francis \cite{AF}):

\begin{quote}
\emph{``For a factorization algebra $\mathcal{F}$ on a manifold $M$, its factorization homology 
$\int_M \mathcal{F}$ is computed by a Čech-type complex over the Ran space of $M$.''}
\end{quote}

For chiral algebras (2d factorization algebras with conformal structure), this becomes:
$$\int_X \mathcal{A} \simeq \text{colim}_{n} \left[ \mathcal{A}^{\otimes n} \otimes \Omega^*(\text{Conf}_n(X)) \right]$$

The bar complex is precisely the dual construction, explaining its geometric nature.
\end{remark}

\subsection{The Genus Expansion: A Physical and Geometric Panorama}
\label{sec:genus_expansion_panorama}

Let us pause to understand, with Witten's physical intuition and Grothendieck's
panoramic vision, why genus appears naturally in our story. This will prepare
the reader for the technical developments to come.

\subsubsection{The Elementary Observation}

Consider a chiral algebra $\mathcal{A}$ on a curve $X$. The bar-cobar complex
$C_{\bullet}(\mathcal{A})$ involves tensor products of $\mathcal{A}$ at distinct
points of $X$. When we form these tensors:
$$\mathcal{A}_{x_1} \otimes \mathcal{A}_{x_2} \otimes \cdots \otimes \mathcal{A}_{x_n}$$
and study their correlations, we are secretly asking: \emph{what surfaces connect
these points?}

\begin{itemize}
\item \textbf{Genus 0 (Tree level):} Points connected by a sphere --- this gives
the classical bar complex, the associative structure.

\item \textbf{Genus 1 (One loop):} Points connected by a torus --- this is where
\emph{central extensions} first appear. The trace $\operatorname{Tr}(a \otimes b)$
around the $S^1$ of the torus encodes the central charge.

\item \textbf{Genus $g \geq 2$ (Multiple loops):} Surfaces with multiple handles ---
higher genus corrections to the OPE, encoding deep modular structure.
\end{itemize}

\subsubsection{The Geometric Construction}

Following Kontsevich's principle of making everything explicit and computable,
consider configuration spaces:
$$\mathrm{Conf}_n(\Sigma_g) = \{ (x_1, \ldots, x_n) \in \Sigma_g^n \mid x_i \neq x_j \text{ for } i \neq j \}$$
for $\Sigma_g$ a Riemann surface of genus $g$.

The \textbf{genus $g$ bar complex} is precisely:
$$C_{\bullet}^{(g)}(\mathcal{A}) = \int_{\mathrm{Conf}_{\bullet}(\Sigma_g)} 
\mathcal{A}^{\boxtimes \bullet}$$
where the integration is factorization homology in the sense of Ayala-Francis.

\subsubsection{The Functorial Uniqueness}

The profound insight: the genus stratification is not a choice but a \emph{necessity}.
The category of chiral algebras naturally extends to a category of \textbf{modular
chiral algebras}, where operations are parametrized by:
$$\mathcal{P}(g,n) = \text{moduli of genus-}g\text{ curves with }n\text{ marked points}$$

The functor:
$$\mathcal{A} \mapsto \{ C_{\bullet}^{(g)}(\mathcal{A}) \}_{g \geq 0}$$
is uniquely determined by:
\begin{enumerate}
\item Functoriality under degenerations $\Sigma_g \rightsquigarrow \Sigma_{g-1}$
(separating a handle)
\item Compatibility with factorization
\item Genus 0 data (the classical structure)
\end{enumerate}

\subsubsection{The Physical Interpretation}

In conformal field theory, the genus expansion \emph{is} the loop expansion:
$$Z_{\text{CFT}} = \sum_{g=0}^{\infty} \hbar^{g-1} \int_{\mathcal{M}_g} F_g$$
where $\mathcal{M}_g$ is the moduli space of genus-$g$ curves.

Our bar-cobar construction at genus $g$ computes exactly the integrand $F_g$.
The central charge $\kappa$ plays the role of $\hbar$.

\begin{theorem}[Operadic Bar Complex]\label{thm:operadic-bar}
For an operad $\mathcal{P}$ and $\mathcal{P}$-algebra $A$, the bar complex is:
$$B_{\mathcal{P}}(A) = \bigoplus_{n \geq 0} (\mathcal{P}(n) \otimes_{\Sigma_n} A^{\otimes n})[n-1]$$
with differential combining operadic composition and algebra structure.
\end{theorem}

\begin{theorem}[Geometric Realization - The Bridge]\label{thm:geometric-bridge}
For the chiral operad $\mathcal{P}_{\text{ch}}$ on a curve $X$:
\begin{enumerate}
\item $\mathcal{P}_{\text{ch}}(n) \cong \Omega^{n-1}(\overline{C}_n(X))$ (Kontsevich-Soibelman)
\item The operadic composition corresponds to boundary stratification
\item The bar differential becomes residues at collision divisors
\end{enumerate}

This provides a canonical isomorphism:
$$B_{\mathcal{P}_{\text{ch}}}(\mathcal{A}) \cong \bar{B}^{\text{ch}}_{\text{geom}}(\mathcal{A})$$
\end{theorem}

\begin{proof}[Conceptual Proof]
The key insight is recognizing three equivalent descriptions:

\textbf{1. Algebraic (Cotriple):} The bar construction is the comonad resolution
$$\cdots \rightrightarrows \mathcal{P} \circ \mathcal{P} \circ A \rightrightarrows \mathcal{P} \circ A \to A$$

\textbf{2. Categorical (Lurie):} This computes $\text{RHom}_{\mathcal{P}\text{-alg}}(\text{Free}_{\mathcal{P}}(\ast), A)$

\textbf{3. Geometric (Kontsevich):} For the chiral operad, free algebras are sections over configuration spaces

The isomorphism follows from:
$$\mathcal{P}_{\text{ch}}(n) = \pi_*\mathcal{O}_{\text{Conf}_n(X)} \cong \Omega^{n-1}(\overline{C}_n(X))$$
where the last isomorphism uses Poincaré duality and the fact that configuration spaces are $K(\pi,1)$ spaces.
\end{proof}

\section{Com-Lie Koszul Duality from First Principles}
 
\section{Quadratic Operads and Koszul Duality}
 
We now specialize to quadratic operads, which admit a particularly refined duality theory:
 
\begin{definition}[Quadratic Operad]
A quadratic operad has the form $P = \Free(E)/(R)$ where:
\begin{itemize}
\item $E$ is a collection of generating operations concentrated in arity 2
\item $R \subset \Free(E)(3)$ consists of quadratic relations (involving exactly two compositions)
\item $\Free$ denotes the free operad functor
\item $(R)$ denotes the operadic ideal generated by $R$
\end{itemize}
\end{definition}
 
\begin{definition}[Koszul Dual Cooperad]
The Koszul dual cooperad $P^!$ is the maximal sub-cooperad of the cofree cooperad $T^c(s^{-1}E^\vee)$ cogenerated by the orthogonal relations $R^\perp \subset (s^{-1}E^\vee)^{\otimes 2}$, where the orthogonality is with respect to the natural pairing induced by evaluation.
\end{definition}
 
\begin{definition}[Koszul Operad]
An operad $P$ is \emph{Koszul} if the canonical map $\Omega(P^!) \to P$ is a quasi-isomorphism. Equivalently, the Koszul complex $K_\bullet(P) = P^! \circ P$ with differential induced by the cooperad and operad structures is acyclic in positive degrees.
\end{definition}
 
\section{Derivation of Com-Lie Duality}
 
We now prove the fundamental duality between the commutative and Lie operads:
 
\begin{theorem}[Com-Lie Koszul Duality]\label{thm:com-lie}
We have canonical isomorphisms of cooperads:
\[
\Com^! \cong \text{co}\Lie \quad \text{and} \quad \Lie^! \cong \text{co}\Com
\]
Moreover, both $\Com$ and $\Lie$ are Koszul operads with quasi-isomorphisms:
\[
\Omega(\text{co}\Lie) \xrightarrow{\sim} \Com, \quad \Omega(\text{co}\Com) \xrightarrow{\sim} \Lie
\]
\end{theorem}
 
\begin{proof}[Proof via Partition Lattices]
By Theorem \ref{thm:partition}, $\barB(\Com)(n) \simeq s^{n-2}\tilde{C}_{n-2}(\barPi_n) \otimes \sgn_n$.
 
Classical results of Björner-Wachs \cite{BW93} and Stanley \cite{Sta97} establish that the reduced homology of $\barPi_n$ is:
\begin{itemize}
\item The complex $\tilde{C}_*(\barPi_n)$ has homology concentrated in degree $n-2$
\item The $S_n$-representation on $\tilde{H}_{n-2}(\barPi_n)$ decomposes as $\Lie(n) \otimes \sgn_n$ where $\Lie(n)$ is the Lie representation
\item $\tilde{H}_k(\barPi_n) = 0$ for $k \neq n-2$
\end{itemize}
 
The key observation is that $\barPi_n$ has the homology of a wedge of $(n-1)!$ spheres of dimension $n-2$, with the $S_n$-action on the top homology given by the Lie representation tensored with the sign.

To see why this yields Com-Lie duality, observe that the bar construction gives:
$$\barB(\Com)(n) \simeq s^{n-2}\tilde{C}_{n-2}(\barPi_n) \otimes \sgn_n$$
Taking homology and using that $\barPi_n$ is $(n-3)$-connected:
$$H_*(\barB(\Com)(n)) \simeq s^{n-2}\Lie(n) \otimes \sgn_n \otimes \sgn_n = s^{n-2}\Lie(n)$$
Since this is concentrated in a single degree, the bar complex is formal and we obtain:
$$\barB(\Com) \simeq \text{co}\Lie[1]$$
as required.
 
Since the bar complex has homology concentrated in a single degree, it follows that:
\[
H_*(\barB(\Com)) \cong \text{co}\Lie[1]
\]
where the shift accounts for the suspension. Applying $\Omega$ yields $\Omega(\text{co}\Lie) \simeq \Com$.
 
The dual statement $\Lie^! \cong \text{co}\Com$ follows by Schur-Weyl duality, using the characterization of $\Lie$ as the primitive part of the tensor coalgebra.
\end{proof}
 
\begin{proof}[Alternative Proof via Generating Series]
The Poincaré series of the operads satisfy:
\begin{align}
P_{\Com}(x) &= e^x - 1 \\
P_{\Lie}(x) &= -\log(1 - x)
\end{align}
These are compositional inverses: $P_{\Lie}(-P_{\Com}(-x)) = x$. This functional equation characterizes Koszul dual pairs, providing an independent verification of the duality.
\end{proof}
 
\section{The Quadratic Dual and Orthogonality}
 
For explicit computations, we need the quadratic presentations:
 
\begin{proposition}[Quadratic Presentations]
The operads $\Com$ and $\Lie$ have quadratic presentations:
\begin{align}
\Com &= \Free(\mu)/(R_{\Com}) \text{ where } R_{\Com} = \langle \mu_{12,3} - \mu_{1,23}, \mu_{12} - \mu_{21} \rangle \\
\Lie &= \Free(\ell)/(R_{\Lie}) \text{ where } R_{\Lie} = \langle \ell_{12,3} + \ell_{23,1} + \ell_{31,2}, \ell_{12} + \ell_{21} \rangle
\end{align}
where subscripts denote inputs, and composition is denoted by adjacency. Here $\mu_{12,3}$ means $\mu \circ_1 \mu$ and $\mu_{1,23}$ means $\mu \circ_2 \mu$.
\end{proposition}
 
\begin{proposition}[Orthogonality]\label{prop:orthogonal}
Under the natural pairing between $\Free(\mu)(3)$ and $\Free(\ell^*)(3)$ induced by $\langle \mu, \ell^* \rangle = 1$, we have:
\[
R_{\Com} \perp R_{\Lie}
\]
This orthogonality is the concrete manifestation of Koszul duality.
\end{proposition}
 
\begin{proof}
We compute the pairing explicitly. The spaces have bases:
\begin{align}
\Free(\mu)(3) &= \text{span}\{\mu_{12,3}, \mu_{1,23}, \mu_{13,2}, \mu_{2,13}, \mu_{23,1}, \mu_{3,12}\} \\
\Free(\ell^*)(3) &= \text{span}\{\ell^*_{12,3}, \ell^*_{1,23}, \text{etc.}\}
\end{align}
 
The pairing $\langle \mu_{ij,k}, \ell^*_{pq,r} \rangle = 1$ if the tree structures match and $0$ otherwise. Computing:
\begin{align}
\langle \mu_{12,3} - \mu_{1,23}, \ell^*_{12,3} + \ell^*_{23,1} + \ell^*_{31,2} \rangle &= 1 + 0 + 0 - 0 - 0 - 1 = 0 \\
\langle \mu_{12,3} - \mu_{1,23}, \ell^*_{13,2} + \ell^*_{32,1} + \ell^*_{21,3} \rangle &= 0 - 1 + 0 + 0 + 1 + 0 = 0
\end{align}
Similar computations for all pairs verify the orthogonality.
\end{proof}
